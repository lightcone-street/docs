---
title: 'User Stream'
description: 'Real-time updates for user orders, fills, and balances'
---

## Overview

The `user` channel provides a unified stream of all user-specific events:
- Order placements (new orders resting on book)
- Order status changes (matching, partial fills, full fills)
- Order cancellations
- Balance updates after deposits/withdrawals
- Nonce updates (when `incrementNonce` is called on-chain)
- Trigger order events (stop-loss, take-profit, triggered/failed/expired)

Upon subscription, you receive an **initial snapshot** of all open orders and balances, followed by real-time updates.

All prices and amounts are returned as **decimal strings** (e.g., `"0.65"`, `"1.5"`) matching the REST API format.

<Warning>
**Authentication Required**: The user stream requires authentication. See [WebSocket Authentication](/websocket/authentication) for details.
</Warning>

## Subscribe

To subscribe to the user stream, connect with authentication and send:

```json
{
  "method": "subscribe",
  "params": {
    "type": "user",
    "wallet_address": "YOUR_WALLET_ADDRESS"
  }
}
```

## Initial Snapshot

Immediately after subscribing, you receive the user's current state:

```json
{
  "type": "user",
  "version": 0.1,
  "data": {
    "event_type": "snapshot",
    "orders": [
      {
        "market_pubkey": "FjVJXzKknRoxgdQHNfdMkzq2vswGacM3MHiZhahczBsL",
        "orderbook_id": "5BNoPgYe_CrhujZLf",
        "order_hash": "0xabc123...",
        "side": "bid",
        "amount_in": "2.000000",
        "amount_out": "1.300000",
        "remaining": "1.000000",
        "filled": "1.000000",
        "price": "0.650000",
        "created_at": 1736456789000,
        "expiration": 0,
        "base_mint": "5BNoPgYemyrbS4ub7MTuKczoYA7qtJZTj5m7xVanupPR",
        "quote_mint": "CrhujZLfmzffVjwUTk6wL1mYeF9nRkx4MBvHmEotnaDF",
        "outcome_index": 0,
        "status": "OPEN"
      }
    ],
    "balances": {
      "5BNoPgYe_CrhujZLf": {
        "market_pubkey": "FjVJXzKknRoxgdQHNfdMkzq2vswGacM3MHiZhahczBsL",
        "orderbook_id": "5BNoPgYe_CrhujZLf",
        "outcomes": [
          {
            "outcome_index": 0,
            "mint": "5BNoPgYemyrbS4ub7MTuKczoYA7qtJZTj5m7xVanupPR",
            "idle": "5.000000",
            "on_book": "2.000000"
          },
          {
            "outcome_index": 1,
            "mint": "79s9ZAcN4zeegreY5m5S86HEsEdCt2KibspWfoUsAq3s",
            "idle": "3.000000",
            "on_book": "0.000000"
          }
        ]
      }
    },
    "nonce": 0
  }
}
```

## Order Events

Order events come with a `event_type` and `type` fields to distinguish event categories and fill lifecycle.

### Event Structure

```json
{
  "type": "user",
  "version": 0.1,
  "data": {
    "event_type": "order",
    "type": "PLACEMENT | UPDATE | CANCELLATION",
    "market_pubkey": "FjVJXzKknRoxgdQHNfdMkzq2vswGacM3MHiZhahczBsL",
    "orderbook_id": "5BNoPgYe_CrhujZLf",
    "timestamp": "2026-01-09T20:43:24.123Z",
    "order": {
      "order_hash": "0xabc123...",
      "status": "OPEN | MATCHING | FILLED | CANCELLED",
      "price": "0.650000",
      "fill_amount": "1.000000",
      "remaining": "0.000000",
      "filled": "1.000000",
      "side": "bid",
      "is_maker": false,
      "created_at": 1736456789000,
      "base_mint": "5BNoPgYemyrbS4ub7MTuKczoYA7qtJZTj5m7xVanupPR",
      "quote_mint": "CrhujZLfmzffVjwUTk6wL1mYeF9nRkx4MBvHmEotnaDF",
      "outcome_index": 0,
      "balance": { ... }
    }
  }
}
```

### Order Lifecycle

| type | status | Description |
|------|--------|-------------|
| `PLACEMENT` | `OPEN` | New order placed on the orderbook |
| `UPDATE` | `MATCHING` | Order locked for in-flight blockchain transaction |
| `UPDATE` | `OPEN` | Partial fill completed (order still has remaining) |
| `UPDATE` | `OPEN` | Transaction failed, order rolled back to open |
| `UPDATE` | `FILLED` | Order fully filled (remaining = 0) |
| `CANCELLATION` | `CANCELLED` | Order cancelled by user |

### Status Definitions

- **OPEN**: Order is resting on the orderbook, available for matching
- **MATCHING**: Order is locked while the solana transaction awaits confirmation
- **FILLED**: Order has been completely filled (remaining = 0)
- **CANCELLED**: Order was cancelled by the user

### Example: Order Placement

```json
{
  "type": "user",
  "data": {
    "event_type": "order",
    "type": "PLACEMENT",
    "order": {
      "order_hash": "0xabc123...",
      "status": "OPEN",
      "remaining": "1.000000",
      "filled": "0.000000",
      "balance": { ... }
    }
  }
}
```

### Example: Order Matching (In-Flight Transaction)

```json
{
  "type": "user",
  "data": {
    "event_type": "order",
    "type": "UPDATE",
    "order": {
      "order_hash": "0xabc123...",
      "status": "MATCHING",
      "remaining": "1.000000",
      "filled": "0.000000"
    }
  }
}
```

### Example: Order Filled

```json
{
  "type": "user",
  "data": {
    "event_type": "order",
    "type": "UPDATE",
    "order": {
      "order_hash": "0xabc123...",
      "status": "FILLED",
      "remaining": "0.000000",
      "filled": "1.000000",
      "balance": { ... }
    }
  }
}
```

### Example: Order Cancelled

```json
{
  "type": "user",
  "data": {
    "event_type": "order",
    "type": "CANCELLATION",
    "order": {
      "order_hash": "0xabc123...",
      "status": "CANCELLED",
      "remaining": "0.000000",
      "filled": "0.500000",
      "balance": { ... }
    }
  }
}
```

## Balance Updates

Deposits and withdrawals trigger `balance_update` events:

```json
{
  "type": "user",
  "version": 0.1,
  "data": {
    "event_type": "balance_update",
    "market_pubkey": "FjVJXzKknRoxgdQHNfdMkzq2vswGacM3MHiZhahczBsL",
    "orderbook_id": "5BNoPgYe_CrhujZLf",
    "balance": {
      "outcomes": [
        {
          "outcome_index": 0,
          "mint": "5BNoPgYemyrbS4ub7MTuKczoYA7qtJZTj5m7xVanupPR",
          "idle": "5.000000",
          "on_book": "0.000000"
        },
        {
          "outcome_index": 1,
          "mint": "79s9ZAcN4zeegreY5m5S86HEsEdCt2KibspWfoUsAq3s",
          "idle": "5.000000",
          "on_book": "0.000000"
        }
      ]
    },
    "timestamp": "2026-01-09T20:43:24.123Z"
  }
}
```

## Nonce Updates

When a user calls `incrementNonce` on-chain, a `nonce` event is emitted. This cancels **all open orders across all markets** that were placed with a nonce below the new value. The client should treat this message as a bulk cancel of all existing orders.

```json
{
  "type": "user",
  "version": 0.1,
  "data": {
    "event_type": "nonce",
    "user_pubkey": "EzW4uwQfdzvqG51vvCrLxjvrZ2vyDpWndAV3YZuaV8if",
    "new_nonce": 5,
    "timestamp": "2026-01-09T20:43:24.123Z"
  }
}
```

## Trigger Order Events

When a trigger order (stop-loss, take-profit, conditional) is triggered by a price movement, a `trigger_order` event is emitted. This tells the client what happened when the trigger condition was met.

### Event Structure

```json
{
  "type": "user",
  "version": 0.1,
  "data": {
    "event_type": "trigger_order",
    "trigger_order_id": "stop_abc123def456...",
    "market_pubkey": "FjVJXzKknRoxgdQHNfdMkzq2vswGacM3MHiZhahczBsL",
    "orderbook_id": "5BNoPgYe_CrhujZLf",
    "trigger_price": "0.6500",
    "trigger_above": true,
    "status": "triggered",
    "order_hash": "0xabc123...",
    "side": "bid",
    "result_status": "filled",
    "result_filled": "10.000000",
    "result_remaining": "0.000000",
    "timestamp": "2026-01-09T20:43:24.123Z"
  }
}
```

### Trigger Order Status Values

| status | Description |
|--------|-------------|
| `triggered` | Trigger order was triggered and the pre-signed order was submitted successfully |
| `failed` | Trigger order was triggered but submission failed (e.g., insufficient balance). The trigger order is re-inserted and will retry on the next price movement |
| `expired` | Trigger order was triggered but the pre-signed order had expired. The trigger order is removed |

### Fields

| Field | Description |
|-------|-------------|
| `trigger_order_id` | ID of the trigger order |
| `trigger_price` | The price threshold that was crossed (decimal string) |
| `trigger_above` | `true` = triggered when price is at or above trigger_price, `false` = triggered when price is at or below trigger_price |
| `order_hash` | Keccak256 hash of the pre-signed order |
| `side` | `"bid"` or `"ask"` |
| `result_status` | Result from order submission: `"filled"`, `"accepted"`, `"rejected"`, or empty on failure |
| `result_filled` | Amount filled from the triggered order (decimal string) |
| `result_remaining` | Remaining amount after trigger execution (decimal string) |

<Note>
When a trigger order triggers successfully, you will also receive the normal **order events** (PLACEMENT, UPDATE, etc.) for the resulting order. The `trigger_order` event provides the additional context that this order originated from a stop/TP/SL trigger.
</Note>

## Event Types Summary

| Event | Type | Description |
|------------|------|-------------|
| `snapshot` | - | Initial state with all open orders and balances |
| `order` | `PLACEMENT` | New order placed on book |
| `order` | `UPDATE` | Order status change (matching, filled, partial fill) |
| `order` | `CANCELLATION` | Order cancelled by user |
| `balance_update` | - | Balance change from deposit/withdrawal |
| `nonce` | - | User nonce incremented on-chain (stale orders cancelled) |
| `trigger_order` | - | Trigger order (stop-loss, take-profit, conditional) triggered, failed, or expired |

## Order Status Summary

| status | Description |
|--------|-------------|
| `OPEN` | Order resting on orderbook |
| `MATCHING` | Order locked for in-flight transaction |
| `FILLED` | Order fully filled |
| `CANCELLED` | Order cancelled |

## Unsubscribe

```json
{
  "method": "unsubscribe",
  "params": {
    "type": "user"
  }
}
```
