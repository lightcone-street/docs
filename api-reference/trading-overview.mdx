Lightcone is a prediction market exchange where users trade **conditional
tokens** representing outcomes of real-world events. This page covers the
core concepts you need to understand before submitting your first order.

## Core Concepts

### Markets

A market represents a question with multiple possible outcomes (e.g.,
"Who will win the election?" with outcomes A, B, C). Each market is
identified by a `market_pubkey`.

Key market fields:

| Field | Description |
|-------|-------------|
| `market_pubkey` | Unique identifier (Solana public key) |
| `num_outcomes` | Number of possible outcomes |
| `market_status` | Current state of the market |
| `winning_outcome` | Set after settlement |

### Conditional Tokens

Each outcome in a market has a corresponding **conditional token** - an
on-chain SPL token that is redeemable for the deposit asset if that
outcome wins. For a market with 3 outcomes, there are 3 conditional tokens.

Each conditional token has:

| Field | Description |
|-------|-------------|
| `token_address` | The SPL token mint address |
| `outcome_index` | Which outcome this token represents (0-indexed) |
| `decimals` | Token decimal precision |

### Deposit Assets (Collateral)

Deposit assets are the collateral tokens used to mint conditional tokens.
When you deposit collateral, you receive a set of conditional tokens (one
per outcome). When a market settles, winning conditional tokens are
redeemable for the deposit asset.

### Orderbooks

An orderbook facilitates trading between two conditional tokens from the
same market. The `orderbook_id` is derived from the base and quote token
pair.

| Field | Description |
|-------|-------------|
| `orderbook_id` | Identifier for the token pair |
| `base_token` | The conditional token being bought/sold |
| `quote_token` | The conditional token used as payment |
| `tick_size` | Minimum price increment |
| `last_trade_price` | Most recent execution price |

## Positions

A position represents your holdings across all outcomes of a market:

```json
{
"position_pubkey": "...",
"owner": "your_wallet_pubkey",
"market_pubkey": "...",
"outcomes": [
{
"outcome_index": 0,
"conditional_token": "mint_address",
"balance": "10.000000",
"balance_idle": "7.000000",
"balance_on_book": "3.000000"
},
{
"outcome_index": 1,
"conditional_token": "mint_address",
"balance": "5.000000",
"balance_idle": "5.000000",
"balance_on_book": "0.000000"
}
]
}
```

| Balance field | Description |
|---------------|-------------|
| balance | Total token balance for this outcome |
| balance_idle | Available balance (not committed to orders) |
| balance_on_book | Balance locked in open orders |

## Orders

### Order Structure

Every order is a limit order to buy or sell a base token in exchange for
a quote token on a specific orderbook.

```json
{
"maker": "your_wallet_pubkey",
"nonce": 1704067200,
"market_pubkey": "...",
"base_token": "conditional_token_mint",
"quote_token": "conditional_token_mint",
"side": 0,
"maker_amount": 1000000,
"taker_amount": 600000,
"expiration": 1704153600,
"signature": "hex_encoded_64_byte_ed25519_signature",
"orderbook_id": "base_quote"
}
```

| Field | Type | Description |
|-------|------|-------------|
| maker | string | Your wallet public key |
| nonce | integer | Unique identifier to prevent replay (typically a timestamp) |
| market_pubkey | string | The market this order belongs to |
| base_token | string | Conditional token mint (base side of the pair) |
| quote_token | string | Conditional token mint (quote side of the pair) |
| side | integer | 0 = BID (buy base with quote), 1 = ASK (sell base for quote) |
| maker_amount | integer | Raw token amount the maker is offering |
| taker_amount | integer | Raw token amount the maker wants in return |
| expiration | integer | Unix timestamp when the order expires (seconds) |
| signature | string | Hex-encoded ED25519 signature over the order |
| orderbook_id | string | Which orderbook to place the order on |

Important: maker_amount and taker_amount are raw integer values
(not decimal strings). The implied price is derived from the ratio
between these two amounts, adjusted for each token's decimal precision.

### Order Sides

| Side | Value | Description |
|------|-------|-------------|
| BID | 0 | Buy base token, pay with quote token |
| ASK | 1 | Sell base token, receive quote token |

### Signing Orders

Each order must include an ED25519 signature signed by the maker
wallet. This is separate from session authentication - it cryptographically
binds the order to the wallet, ensuring orders cannot be forged.

The signature covers the order parameters (maker, nonce, market, tokens,
side, amounts, expiration). The signature is hex-encoded (128 hex
characters = 64 bytes).

### Submitting Orders

POST /api/orders/submit

The exchange engine processes the order immediately. The response indicates
what happened:

```json
{
"order_hash": "keccak256_hex_hash",
"status": "accepted",
"remaining": "0.500000",
"filled": "0.500000",
"fills": [
{
"counterparty": "maker_pubkey",
"counterparty_order_hash": "hash",
"fill_amount": "0.300000",
"price": "0.600000",
"is_maker": false
}
]
}
```

### Order Statuses

| Status | Description |
|--------|-------------|
| accepted | Order is resting on the book (unfilled or partially filled) |
| partial_fill | Order was partially filled on submission |
| filled | Order was completely filled |
| rejected | Order was rejected by the engine |

### Order Hash

Every order receives a keccak256 hash that serves as its unique
identifier. Use this hash when cancelling orders or tracking fills.

### Cancelling Orders

Cancel a single order

POST /api/orders/cancel

```json
{
"order_hash": "hex_hash",
"maker": "your_wallet_pubkey"
}
```

Cancel all orders

POST /api/orders/cancel-all

```json
{
"user_pubkey": "your_wallet_pubkey",
"market_pubkey": "optional_filter"
}
```

Omit market_pubkey to cancel all orders across all markets.

### Viewing Open Orders

POST /api/users/orders

Returns all open orders and multi-outcome balances for a user.

## Trades

Executed trades are queryable with filtering and pagination:

GET /api/trades?orderbook_id=...&limit=100

Each trade includes:

| Field | Description |
|-------|-------------|
| taker_pubkey | The taker's wallet |
| maker_pubkey | The maker's wallet |
| side | Trade side |
| size | Decimal-scaled fill size |
| price | Decimal-scaled execution price |

## Orderbook Data

GET /api/orderbook/{orderbook_id}?depth=10

Returns a snapshot of bids and asks at each price level. Set depth=0 or
omit it to retrieve all levels.
